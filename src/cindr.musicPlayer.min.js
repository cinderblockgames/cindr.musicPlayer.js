const cindrM=new EventTarget;!function(e){const n={audio:document.createElement("audio"),volume:-1,muted:!1,index:-1,playlist:[],shuffled:[],shuffle:!1,repeat:"none",monitoring:null};n.audio.addEventListener("ended",()=>{"song"==n.repeat?e.song.play():!n.shuffle&&n.index+1<n.playlist.length?e.song.next():n.shuffle&&n.shuffled.indexOf(n.index)+1<n.shuffled.length?e.song.next():"playlist"==n.repeat?e.playlist.play():e.song.stop()}),n.audio.setAttribute("preload","auto"),n.audio.addEventListener("timeupdate",()=>d.timeupdate()),n.audio.addEventListener("progress",()=>d.timeupdate()),n.audio.addEventListener("loadedmetadata",()=>d.timeupdate()),n.audio.addEventListener("ended",()=>d.end()),n.volume=100*n.audio.volume;const t=function(e,n){return typeof e==typeof n&&e<n},o=function(e,n){return typeof e==typeof n&&e<=n},i=function(e,n){return typeof e==typeof n&&e>=n},l={reset:function(){if(n.shuffle){n.shuffled=[...Array(n.playlist.length).keys()].sort(()=>Math.random()-.5);const e=n.shuffled.indexOf(n.index);[n.shuffled[0],n.shuffled[e]]=[n.shuffled[e],n.shuffled[0]]}else n.shuffled=[]},next:function(){const e=n.shuffled.indexOf(n.index)+1,t=e<n.shuffled.length?e:0;l.play(t)},previous:function(){const e=n.shuffled.indexOf(n.index),t=(e>0?e:n.shuffled.length)-1;l.play(t)},play:function(e){n.index=n.shuffled[e],n.audio.pause(),n.audio.currentTime=0,n.audio.src=n.playlist[n.index].url,n.audio.play(),d.songchange(),d.play()}},a={songList:function(e){const t=e.detail;for(;n.monitoring.songList.firstChild;)n.monitoring.songList.removeChild(n.monitoring.songList.lastChild);t.playlist.forEach((e,o)=>{const i=n.monitoring.songListTemplate.cloneNode(!0);i.id+="-"+o,a.song(i,{song:e,index:o,"index-readable":o+1},{clean:!0,current:o==t.index}),n.monitoring.songList.appendChild(i)})},currentSongInfo:function(e){const t=e.detail;if(a.song(document,t),n.monitoring){const e=n.monitoring.songList.querySelectorAll('[id*="cindrM-song-container-"]');for(let n=0;n<e.length;n++){const o=e[n];n==t.index?o.classList.add("cindrM-current-song"):o.classList.remove("cindrM-current-song")}}},currentTime:function(e){const n=e.detail;a.meta(document,n)},playControl:function(){document.querySelectorAll('[data-cindrM-control~="play"]').forEach(e=>e.classList.add("cindrM-control-playing")),["pause","stop"].forEach(e=>{document.querySelectorAll('[data-cindrM-control~="'+e+'"]').forEach(e=>e.classList.remove("cindrM-control-paused"))})},pauseControl:function(){document.querySelectorAll('[data-cindrM-control~="play"]').forEach(e=>e.classList.remove("cindrM-control-playing")),["pause","stop"].forEach(e=>{document.querySelectorAll('[data-cindrM-control~="'+e+'"]').forEach(e=>e.classList.add("cindrM-control-paused"))})},shuffleControl:function(e){const n=document.querySelectorAll('[data-cindrM-control~="shuffle"]');e.detail.shuffle?n.forEach(e=>e.classList.add("cindrM-control-shuffling")):n.forEach(e=>e.classList.remove("cindrM-control-shuffling"))},repeatControl:function(e){const n=e.detail.repeat,t=document.querySelectorAll('[data-cindrM-control~="repeat"]');"none"==n?t.forEach(e=>{e.classList.remove("cindrM-control-repeat-playlist"),e.classList.add("cindrM-control-repeat-none")}):"song"==n?t.forEach(e=>{e.classList.remove("cindrM-control-repeat-none"),e.classList.add("cindrM-control-repeat-song")}):t.forEach(e=>{e.classList.remove("cindrM-control-repeat-song"),e.classList.add("cindrM-control-repeat-playlist")})},volumeControl:function(e){document.querySelectorAll('[data-cindrM-control~="volume"]').forEach(n=>a.node(n,e.detail.volume))},muteControl:function(e){const n=document.querySelectorAll('[data-cindrM-control~="mute"]');e.detail.muted?n.forEach(e=>e.classList.add("cindrM-control-muted")):n.forEach(e=>e.classList.remove("cindrM-control-muted"))},progressControl:function(e){const n=e.detail;if(!Object.is(n.duration,NaN)){document.querySelectorAll('[data-cindrM-control~="progress"]').forEach(e=>a.node(e,n.currentTime/n.duration))}},bufferControl:function(e){const n=e.detail;if(n.buffered.length>0&&!Object.is(n.duration,NaN)){document.querySelectorAll('[data-cindrM-control~="buffer"]').forEach(e=>a.node(e,n.buffered.end(n.buffered.length-1)/n.duration))}},song:function(e,n,t){t=t||{clean:!1,current:!1},e.querySelectorAll("[data-cindrM-song-info]").forEach(e=>{const o=e.getAttribute("data-cindrM-song-info");Object.keys(n.song).includes(o)?a.node(e,n.song[o],t.clean):r.warn("Ignoring invalid cindrM-song-info value request.",o)}),a.meta(e,n,t.clean),t.current&&e.classList.add("cindrM-current-song")},meta:function(e,n,t){e.querySelectorAll("[data-cindrM-song-meta]").forEach(e=>{const o=e.getAttribute("data-cindrM-song-meta");if(Object.keys(n).filter(e=>"song"!=e).includes(o)){const i=o.indexOf("-readable");-1!=i&&Object.is(n[o.substring(0,i)],NaN)||a.node(e,n[o],t)}else r.warn("Ignoring invalid cindrM-song-meta value request.",o)})},node:function(e,n,t){if(["IMG"].includes(e.nodeName)?e.src=n:["PROGRESS","INPUT"].includes(e.nodeName)?e.value=n:e.firstChild?e.firstChild.nodeValue=n:e.textContent=n,t)for(let n=e.attributes.length-1;n>=0;n--){const t=e.attributes[n].nodeName;t.startsWith("data-")&&e.removeAttribute(t)}}},r={warn:function(e,n){console.warn(e+" [("+typeof n+") "+n+"]")},info:function(e,n){console.info(e+" [("+typeof n+") "+n+"]")}},s=function(e){if(!Object.is(e,NaN)){const n=Math.floor(e/3600),t=Math.floor(e%3600/60),o=Math.floor(e%3600%60);return n>0?n+":"+("0"+t).slice(-2)+("0"+o).slice(-2):t+":"+("0"+o).slice(-2)}},d={raise:function(n,t){e.dispatchEvent(new CustomEvent(n,{detail:t}))},play:()=>d.raise("play"),pause:()=>d.raise("pause"),end:()=>d.raise("end"),timeupdate:()=>d.raise("timeupdate",{currentTime:n.audio.currentTime,"currentTime-readable":s(n.audio.currentTime),duration:n.audio.duration,"duration-readable":s(n.audio.duration),buffered:n.audio.buffered}),songchange:()=>d.raise("songchange",{song:n.playlist[n.index],index:n.index,"index-readable":n.index+1,currentTime:n.audio.currentTime,"currentTime-readable":s(n.audio.currentTime),duration:n.audio.duration,"duration-readable":s(n.audio.duration)}),playlistchange:()=>d.raise("playlistchange",{playlist:n.playlist,index:n.index,"index-readable":n.index+1}),shufflechange:()=>d.raise("shufflechange",{shuffle:n.shuffle}),repeatchange:()=>d.raise("repeatchange",{repeat:n.repeat}),volumechange:()=>d.raise("volumechange",{volume:n.volume,muted:n.muted})};e.song={play:function(){n.playlist.length>=0?n.index>-1?(n.audio.play(),d.play()):e.playlist.play():r.warn("Playlist empty; ignoring call to song.play().")},pause:function(){n.playlist.length>=0?(n.audio.pause(),d.pause()):r.warn("Playlist empty; ignoring call to song.pause().")},stop:function(){n.playlist.length>=0?(e.song.pause(),n.audio.currentTime=0):r.warn("Playlist empty; ignoring call to song.stop().")},next:function(){n.playlist.length>0?n.shuffle?l.next():n.index+1<n.playlist.length?e.playlist.seek(n.index+1):e.playlist.play():r.warn("Playlist empty; ignoring call to song.next().")},previous:function(){n.playlist.length>0?(n.audio.currentTime>2&&n.audio.duration>2?n.audio.currentTime=0:n.shuffle?l.previous():n.index>0?e.playlist.seek(n.index-1):e.playlist.seek(n.playlist.length-1),d.songchange()):r.warn("Playlist empty; ignoring call to song.previous().")},seekPercent:function(e){n.playlist.length>=0?i(e,0)&&o(e,100)?n.audio.currentTime=n.audio.duration*(e/100):r.warn("Ignoring invalid value sent to song.seekPercent(percent).",e):r.warn("Playlist empty; ignoring call to song.seekPercent().")},seekTime:function(e){n.playlist.length>=0?i(e,0)&&o(e,n.audio.duration)?n.audio.currentTime=e:r.warn("Ignoring invalid value sent to song.seekTime(seconds).",e):r.warn("Playlist empty; ignoring call to song.seekTime().")}},e.playlist={add:function(e){n.playlist.push(e),-1==n.index&&(n.index=0,n.audio.src=n.playlist[n.index].url,d.songchange()),l.reset(),d.playlistchange()},insert:function(t,a){i(t,0)&&o(t,n.playlist.length)?t==n.playlist.length?e.playlist.add(a):(t<=n.index&&n.index++,n.playlist.splice(t,0,a),l.reset(),d.playlistchange()):r.warn("Ignoring invalid value sent to playlist.insert(index, song).",t)},remove:function(o){if(i(o,0)&&t(o,n.playlist.length)){let t=null;return o<n.index?(t=n.playlist.splice(o,1),n.index--):o==n.index?(n.audio.pause(),n.audio.currentTime=0,n.index+1<n.playlist.length?(t=n.playlist.splice(o,1),e.playlist.seek(n.index)):n.index>0?(t=n.playlist.splice(o,1),n.index--):(t=n.playlist,n.index=-1,n.playlist=[])):t=n.playlist.splice(o,1),l.reset(),d.playlistchange(),t[0]}r.warn("Ignoring invalid value sent to playlist.remove(index).",o)},clear:function(){n.playlist.length>0&&e.playlist.replace([])},replace:function(e){n.audio.pause(),n.audio.currentTime=0,e.length>0?(n.index=0,n.playlist=e,n.audio.src=n.playlist[n.index].url,d.songchange()):(n.index=-1,n.playlist=[],n.audio.src=null),l.reset(),d.playlistchange()},play:function(){n.playlist.length>0?e.playlist.seek(0):r.warn("Playlist empty; ignoring call to playlist.play().")},seek:function(e){i(e,0)&&t(e,n.playlist.length)?(n.index=e,n.audio.pause(),n.audio.currentTime=0,n.audio.src=n.playlist[n.index].url,n.audio.play(),l.reset(),d.songchange(),d.play()):r.warn("Ignoring invalid value sent to playlist.seek(index).",e)}},e.player={volume:function(e){if(!i(e,0)||!o(e,100))return r.info("No valid value sent to player.volume(volume); returning current volume.",e),n.volume;(n.muted||e!=n.volume)&&(n.volume=e,n.audio.volume=n.volume/100,d.volumechange())},mute:function(e){if(!0!==e&&!1!==e)return r.info("No valid value sent to player.mute(mute); returning current mute state.",e),n.muted;e!=n.muted&&(n.muted=e,n.audio.volume=n.muted?0:n.volume/100,d.volumechange())},shuffle:function(e){if(!0!==e&&!1!==e)return r.info("No valid value sent to player.shuffle(shuffle); returning current shuffle state.",e),n.shuffle;e!=n.shuffle&&(n.shuffle=e,l.reset(),d.shufflechange())},repeat:function(e){if("none"!==e&&"song"!==e&&"playlist"!==e)return r.info("No valid value sent to player.repeat(value); returning current repeat type.",e),n.repeat;e!=n.repeat&&(n.repeat=e,d.repeatchange())}},e.ui={monitor:function(){const t=document.getElementById("cindrM-song-list-container");if(t){const o=document.getElementById("cindrM-song-container");o&&(n.monitoring={songList:t,songListTemplate:o.parentElement.removeChild(o)},e.addEventListener("playlistchange",a.songList))}if((document.querySelector("[data-cindrM-song-info]")||document.querySelector("[data-cindrM-song-meta]"))&&e.addEventListener("songchange",a.currentSongInfo),document.querySelector("[data-cindrM-song-meta]")&&e.addEventListener("timeupdate",a.currentTime),document.querySelector("[data-cindrM-control]")){document.querySelectorAll('[data-cindrM-control~="play"]').forEach(n=>n.addEventListener("click",function(){this.classList.contains("cindrM-control-playing")||e.song.play()})),e.addEventListener("play",a.playControl),document.querySelectorAll('[data-cindrM-control~="pause"]').forEach(n=>n.addEventListener("click",function(){this.classList.contains("cindrM-control-paused")||e.song.pause()})),e.addEventListener("pause",a.pauseControl),document.querySelectorAll('[data-cindrM-control~="stop"]').forEach(n=>n.addEventListener("click",function(){this.classList.contains("cindrM-control-paused")||e.song.stop()})),document.querySelectorAll('[data-cindrM-control~="next"]').forEach(n=>{n.addEventListener("click",e.song.next)}),document.querySelectorAll('[data-cindrM-control~="previous"]').forEach(n=>{n.addEventListener("click",e.song.previous)}),document.querySelectorAll('[data-cindrM-control~="shuffle"]').forEach(t=>t.addEventListener("click",function(){e.player.shuffle(!n.shuffle)})),e.addEventListener("shufflechange",a.shuffleControl);const t={none:"song",song:"playlist",playlist:"none"};document.querySelectorAll('[data-cindrM-control~="repeat"]').forEach(o=>o.addEventListener("click",function(){e.player.repeat(t[n.repeat])})),e.addEventListener("repeatchange",a.repeatControl),document.querySelectorAll('[data-cindrM-control~="volume"]').forEach(n=>{const t=function(){e.player.mute(!1),e.player.volume(parseFloat(this.value))};n.addEventListener("mousedown",t),n.addEventListener("input",t),n.addEventListener("change",t)}),e.addEventListener("volumechange",a.volumeControl),document.querySelectorAll('[data-cindrM-control~="mute"]').forEach(t=>t.addEventListener("click",function(){e.player.mute(!n.muted)})),e.addEventListener("volumechange",a.muteControl),e.addEventListener("timeupdate",a.progressControl),document.querySelectorAll('[data-cindrM-control~="seek"]').forEach(n=>n.addEventListener("click",function(n){let t=null;if(this.offsetWidth>this.offsetHeight){t=(n.pageX-this.getBoundingClientRect().left)/this.offsetWidth}else{t=(n.pageY-this.getBoundingClientRect().top)/this.offsetHeight}e.song.seekPercent(100*t)})),e.addEventListener("timeupdate",a.bufferControl),d.pause(),d.repeatchange()}}},e.getInternals=(()=>n)}(cindrM);
